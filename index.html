<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Coca Cola</title>
<style>
    body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: 'Microsoft YaHei', sans-serif;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        transition: background-image 1s ease-in-out;
    }
    #message {
        position: absolute;
        bottom: 10%;
        width: 100%;
        font-size: 4em;
        text-align: center;
        z-index: 3;
        text-shadow: 0 0 10px pink;
        color: white;
    }
    #musicTip {
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 192, 203, 0.8);
        color: white;
        font-size: 1.8em;
        padding: 15px 30px;
        border-radius: 30px;
        box-shadow: 0 0 15px pink;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1.2s ease;
        z-index: 9999;
    }

    /* CSS 爱心 */
    #frame{
        position: absolute;
        width: 400px;
        height: 300px;
        top: 60%;
        left: 30%;
        transform: translate(-50%, -50%);
        z-index: 2;
    }
    .left,.right{
        top: 0;
        width: 200px;
        height: 200px;
        border-radius: 50%;
    }
    .left{
        left: 35px;
    }
    .right{
        right: 35px;
        z-index: -1;
    }
    .bottom{
        bottom: 36px;
        left: 100px;
        width: 200px;
        height: 200px;
        transform: rotate(45deg);
        z-index: -1;
    }
    .heart{
        position: absolute;
        box-shadow:0 0 40px #d5093c;
        animation: beat .8s ease infinite normal;
        background: linear-gradient(-90deg, #F50A45 0%, #d5093c 40%);
    }
    @keyframes beat {
        0%{
            transform: scale(1) rotate(225deg);
            box-shadow:0 0 40px #d5093c;
        }
        50%{
            transform: scale(1.1) rotate(225deg);
            box-shadow: 0 0 70px #d5093c;
        }
        100%{
            transform: scale(1) rotate(225deg);
            box-shadow: 0 0 40px #d5093c;
        }
    }
</style>
</head>
<body>

<div id="message"></div>
<div id="musicTip">🎵</div>

<!-- CSS 爱心结构 -->
<div id="frame">
    <div class="heart left"></div>
    <div class="heart right"></div>
    <div class="heart bottom"></div>
</div>

<audio id="bgm" loop>
    <source src="I-wanted-you.mp3" type="audio/mpeg">
</audio>

<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.156.1/build/three.min.js"></script>

<script>
let bgImages = [
    'images/lzx001.jpeg',
    'images/lzx002.jpeg',
    'images/lzx003.jpeg',
    'images/lzx004.jpeg',
    'images/lzx005.jpeg',
    'images/lzx006.jpeg',
    'images/lzx007.jpeg',
    'images/lzx008.jpeg',
    'images/lzx009.jpeg',
    'images/lzx010.jpeg',
    'images/lzx011.jpeg'
];
let currentIndex = 0;
function changeBackground() {
    document.body.style.backgroundImage = `url('${bgImages[currentIndex]}')`;
    currentIndex = (currentIndex + 1) % bgImages.length;
}
changeBackground();
setInterval(changeBackground, 5000); 

new Typed('#message', {
    strings: [
        "不要生气了， 开心起来 ✨",
        "cool li ➕ cola ➡️ coca cola 🎉",
        "樱唇浅笑含春韵，绿野清风抚黛颦 🌸",
        "愿你于一片远洋风帆，飞向那座山 🕊️",
        "好像在哪见过你，我只在乎你 💖",
        "徐徐回望，曾属于彼此的晚上，红红仍是你，赠我的心中艳阳 💕",
        "徘徊在似苦又甜之间，望不穿这暧昧的眼 🎈",
        "In the year of our Lord twelve thirty nine, there once lived a girl of a royal line ❤️"
    ],
    typeSpeed: 80,
    backSpeed: 50,
    loop: true
});

// Three.js 粒子背景
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 粒子背景
let particlesGeometry = new THREE.BufferGeometry();
let particlesCount = 500;
let posArray = new Float32Array(particlesCount * 3);
for(let i=0; i<particlesCount*3; i++){
    posArray[i] = (Math.random() - 0.5) * 50;
}
particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
let particlesMaterial = new THREE.PointsMaterial({
    size: 0.1,
    color: 0xffc0cb
});
let particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
scene.add(particlesMesh);

// 红色外发光粒子环绕爱心
let orbitParticlesGeometry = new THREE.BufferGeometry();
let orbitCount = 100;
let orbitPositions = new Float32Array(orbitCount * 3);
let radius = 6;
for (let i = 0; i < orbitCount; i++) {
    let angle = (i / orbitCount) * Math.PI * 2;
    orbitPositions[i * 3] = Math.cos(angle) * radius;
    orbitPositions[i * 3 + 1] = (Math.random() - 0.5) * 2;
    orbitPositions[i * 3 + 2] = Math.sin(angle) * radius;
}
orbitParticlesGeometry.setAttribute('position', new THREE.BufferAttribute(orbitPositions, 3));
let orbitParticlesMaterial = new THREE.PointsMaterial({
    size: 0.15,
    color: 0xffc0cb,
    transparent: true,
    opacity: 0.8
});
let orbitParticles = new THREE.Points(orbitParticlesGeometry, orbitParticlesMaterial);
scene.add(orbitParticles);

// 光照
let light1 = new THREE.PointLight(0xffffff, 1);
light1.position.set(10, 10, 10);
scene.add(light1);
let light2 = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(light2);

camera.position.z = 15;

// 屏幕坐标转世界坐标，更新orbitParticles位置，让它围绕红心
function moveParticlesToHeart() {
    const heartRect = document.getElementById('frame').getBoundingClientRect();
    const heartCenterX = heartRect.left + heartRect.width / 2;
    const heartCenterY = heartRect.top + heartRect.height / 2;

    // 转成 NDC 坐标 [-1,1]
    const x = (heartCenterX / window.innerWidth) * 2 - 1;
    const y = -(heartCenterY / window.innerHeight) * 2 + 1;

    // z=0.5 表示中间近平面和远平面之间，避免被裁剪
    const vec = new THREE.Vector3(x, y, 0.5);
    vec.unproject(camera);

    orbitParticles.position.copy(vec);
}

// 动画循环
let clock = new THREE.Clock();
function animate() {
    requestAnimationFrame(animate);
    moveParticlesToHeart(); 
    let t = clock.getElapsedTime();
    particlesMesh.rotation.y += 0.001;
    orbitParticles.rotation.y = t * 0.5;
    renderer.render(scene, camera);
}
animate();

// 点击生成小爱心
document.addEventListener('click', function(e) {
    let heartEl = document.createElement('div');
    heartEl.style.position = 'absolute';
    heartEl.style.left = e.clientX + 'px';
    heartEl.style.top = e.clientY + 'px';
    heartEl.style.fontSize = '20px';
    heartEl.style.color = `hsl(${Math.random()*360},100%,70%)`;
    heartEl.innerHTML = '❤';
    document.body.appendChild(heartEl);
    let rise = 0;
    let interval = setInterval(() => {
        rise++;
        heartEl.style.top = (e.clientY - rise) + 'px';
        heartEl.style.opacity = 1 - rise / 50;
        if (rise > 50) {
            clearInterval(interval);
            heartEl.remove();
        }
    }, 16);
});

// 音乐
let bgm = document.getElementById("bgm");
bgm.muted = true;
bgm.volume = 1;
bgm.play();

const musicTip = document.getElementById('musicTip');
document.addEventListener("click", () => {
    bgm.muted = false;
    bgm.play();
    musicTip.style.opacity = "1";
    setTimeout(() => {
        musicTip.style.opacity = "0";
    }, 2500);
}, { once: true });

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
